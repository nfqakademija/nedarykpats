{% extends 'base.html.twig' %}

{% block body %}

    {% include 'components/flash_bag.html.twig' %}

    <div class="Content Content--top">
        <div class="Content-Block">
        </div>
    </div>

    <div class="Content Content--GreyBg">
        <div class="Content-Block">
            <div class="Content Content--GreyBg ">
                <section class="Content-Block">

                    <div class="u-display-right">
                        <a class="Button" href="/#FilterBar">Atgal</a>
                    </div>

                    {#TODO: neskeminga zinute#}
                    {% if app.session.flashBag.has('success') %}
                        <div class="Alert Alert-success">
                        <span class="Alert-icon">
                            <img src="/img/success.svg" alt="success">
                               {% for msg in app.session.flashBag.get('success') %}
                                   {{ msg }}
                               {% endfor %}
                        </span>
                        </div>
                    {% endif %}

                    <section class="LayoutLine LayoutLine--flex">
                        <section class="LayoutLine-item--fullWidth">
                            <header class="TopBar TopBar--justify">
                                <div class="Date"> {{ advert.createdAt|date("Y-m-d") }}</div>
                                {% if advert.getOffersCount()  > 0 %}
                                    <div class="Bid">
                                        <span class="Bid-header">Aplikavo</span>
                                        <span class="Bid-count">{{ advert.getOffersCount() }}</span>
                                    </div>
                                {% endif %}
                            </header>

                            <h3 class="Header1">{{ advert.title }}</h3>

                            <div class="Paragraph">
                                <p>{{ advert.text }}</p>
                            </div>

                            <footer class="u-margin-top">
                                <ul class="u-no-padding">
                                    {% for advertCategory in advert.categories %}
                                        <li class="Category {{ advertCategory.cssStyle }}">{{ advertCategory.title }}</li>
                                    {% endfor %}
                                </ul>
                            </footer>
                        </section>

                        <section class="StatusBlock StatusBlock--hired">
                            <img class="StatusBlock-icon" src="/img/status-hired.svg" alt="Status hired">
                            <p class="StatusBlock-title">Pasamdytas!</p>
                        </section>
                    </section>

                    <section id="writeReviewModal" class="Modal">
                        <div id="writeReview"></div>
                    </section>

                    {#----Offerių bloko pradžia------#}
                    <section class="LayoutGrid LayoutGrid--col2">
                        {% if(advert.offers is not empty and is_granted('IS_AUTHENTICATED_FULLY') ) %}
                            {% for offer in advert.offers %}
                                {% if (app.user == offer.user or app.user == advert.user ) %}
                                    {% include 'components/offer_component/offer_show.html.twig' %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </section>
                    {#----Offerių bloko pabaiga------#}

                    {% if advertIsNotUsers(app.user, advert) and userHasNotSubmittedOffer(app.user, advert) %}
                        {{ form_start(offerForm, {'attr': {'class' : 'Form Form-background'}}) }}

                        <h3 class="Header1">Parašyk savo pasiūlymą!</h3>

                        {% if (is_granted('IS_AUTHENTICATED_FULLY') == false) %}

                            <div class="Form-item">
                                {{ form_label(offerForm.email,'Elektroninis paštas') }}
                                {{ form_widget(offerForm.email) }}
                                <span class="Form-errors">
                             {{ form_errors(offerForm.email) }}
                            </span>
                            </div>

                            <div class="Form-item">
                                {{ form_label(offerForm.name,'Tavo vardas') }}
                                {{ form_widget(offerForm.name) }}
                                <span class="Form-errors">
                             {{ form_errors(offerForm.name) }}
                            </span>
                            </div>

                        {% else %}

                            <div class="Form-item" hidden>
                                {{ form_widget(offerForm.email, {'value' : app.user.email}) }}
                            </div>

                            {% if app.user.name is not empty %}
                                <div class="Form-item" hidden>
                                    {{ form_widget(offerForm.name, {'value' : app.user.name}) }}
                                </div>

                            {% else %}
                                <div class="Form-item" hidden>
                                    {{ form_widget(offerForm.name, {'value' : app.user.name}) }}
                                </div>
                            {% endif %}

                        {% endif %}

                        <div class="Form-item">
                            {{ form_label(offerForm.text, 'Žinutė skelbimo autoriui') }}
                            {{ form_widget(offerForm.text, {'attr': {'rows': '10'} }) }}
                            <span class="Form-errors">
                         {{ form_errors(offerForm.text) }}
                    </span>
                        </div>

                        {{ form_row(offerForm.save , {'attr' : {'class' : 'Button Button--blue'}}) }}

                        {{ form_end(offerForm) }}
                    {% endif %}
                </section>
            </div>
        </div>
    </div>








    <script>
        var usingVersionedFileJs = true;
        var usingReactApp = true;
    </script>
    {{ parent() }}

{% endblock %}
